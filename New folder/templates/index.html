<!DOCTYPE html>
<html>

<head>
    <title>Face Recognition System</title>
</head>

<body>

    <h2>Face Recognition System</h2>

    <!-- Department -->
    <select id="deptDropdown">
        <option value="">Select Department</option>
        {% for d in departments %}
        <option value="{{ d.deptId }}">{{ d.departmentName }}</option>
        {% endfor %}
    </select>

    <br><br>

    <!-- Role -->
    <select id="roleDropdown">
        <option value="">Select Role</option>
    </select>

    <br><br>

    <!-- Employee -->
    <select id="empDropdown">
        <option value="">Select Employee</option>
    </select>

    <br><br>

    <form action="/register" method="post">
        <input type="hidden" name="empId" id="empIdInput">
        <input type="hidden" name="empName" id="empNameInput">

        <button type="submit" id="registerBtn" disabled>Register Face</button>
    </form>

    <br><br>

    <form action="/attendance" method="post">
        <button type="submit">Mark Attendance</button>
    </form>

    <script>

        const deptDropdown = document.getElementById("deptDropdown");
        const roleDropdown = document.getElementById("roleDropdown");
        const empDropdown = document.getElementById("empDropdown");
        const registerBtn = document.getElementById("registerBtn");


        // Department change
        deptDropdown.addEventListener("change", function () {

            const deptId = this.value;

            roleDropdown.innerHTML = '<option value="">Select Role</option>';
            empDropdown.innerHTML = '<option value="">Select Employee</option>';
            registerBtn.disabled = true;

            if (!deptId) return;

            fetch(`/designations/${deptId}`)
                .then(res => res.json())
                .then(data => {
                    data.forEach(role => {
                        roleDropdown.innerHTML +=
                            `<option value="${role.desigId}">${role.designationName}</option>`;
                    });
                });
        });


        // Role change
        roleDropdown.addEventListener("change", function () {

            const deptId = deptDropdown.value;
            const desigId = roleDropdown.value;

            empDropdown.innerHTML = '<option value="">Select Employee</option>';
            registerBtn.disabled = true;

            if (!deptId || !desigId) return;

            fetch(`/employees/${deptId}/${desigId}`)
                .then(res => res.json())
                .then(data => {
                    data.forEach(emp => {
                        empDropdown.innerHTML +=
                            `<option value="${emp.employmentId}">${emp.empName}</option>`;
                    });
                });
        });


        // Employee selected
        empDropdown.addEventListener("change", function () {

            const selectedOption = this.options[this.selectedIndex];

            if (selectedOption.value !== "") {
                registerBtn.disabled = false;
                document.getElementById("empIdInput").value = selectedOption.value;
                document.getElementById("empNameInput").value = selectedOption.text;
            } else {
                registerBtn.disabled = true;
            }
        });

    </script>

</body>

</html>